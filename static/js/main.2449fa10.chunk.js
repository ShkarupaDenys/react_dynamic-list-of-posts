(this["webpackJsonpreact_dynamic-list-of-posts"]=this["webpackJsonpreact_dynamic-list-of-posts"]||[]).push([[0],{19:function(e,t,n){},20:function(e,t,n){},23:function(e,t,n){"use strict";n.r(t);var s,r,c,a=n(12),o=n.n(a),i=n(2),l=n(1),d=(n(17),n(18),n(19),n(3)),u=n.n(d),m=(n(20),n(0)),j=function(){return Object(m.jsx)("div",{className:"Loader","data-cy":"Loader",children:Object(m.jsx)("div",{className:"Loader__content"})})},b=n(5),h=n(4),O=n.n(h);!function(e){e.None="",e.GetUsers="get users",e.GetPosts="get posts",e.GetComments="get comments",e.RemoveComment="remove comments",e.AddComment="add comments"}(s||(s={})),function(e){e.Danger="danger",e.Warning="warning"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Comments=1]="Comments",e[e.Posts=2]="Posts",e[e.AddComment=3]="AddComment"}(c||(c={}));var x={post:{id:0,userId:0,title:"",body:""},error:s.None,loading:c.None,comments:[],setLoading:function(){},setComments:function(){},setError:function(){}},f=Object(l.createContext)(x),v={currentUserId:0,error:s.None},p=Object(l.createContext)(v),C=function(e){var t=e.id,n=e.name,s=e.selectUser,r=Object(l.useContext)(p).currentUserId;return Object(m.jsx)("a",{href:"#user-".concat(t),className:u()("dropdown-item",{"is-active":r===t}),onClick:function(){return s(t)},children:n})},g=function(e){var t=e.users,n=e.selectUser;return Object(m.jsx)("div",{role:"menu",id:"dropdown-menu",className:"dropdown-menu",children:Object(m.jsx)("div",{className:"dropdown-content",children:t.map((function(e){var t=e.id,s=e.name;return Object(m.jsx)(C,{id:t,name:s,selectUser:n},t)}))})})},N=function(e){var t=e.userName,n=e.toggleDropdown,r=Object(l.useContext)(p).error;return Object(m.jsx)("div",{className:"dropdown-trigger",children:Object(m.jsxs)("button",{type:"button",className:"button","aria-haspopup":"true","aria-controls":"dropdown-menu",onClick:n,disabled:r===s.GetUsers,children:[Object(m.jsx)("span",{children:t||"Choose a user"}),Object(m.jsx)("span",{className:"icon is-small",children:Object(m.jsx)("i",{className:"fas fa-angle-down","aria-hidden":"true"})})]})})},y="https://mate.academy/students-api";function w(e){return new Promise((function(t){setTimeout(t,e)}))}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s={method:t};return n&&(s.body=JSON.stringify(n),s.headers={"Content-Type":"application/json; charset=UTF-8"}),w(300).then((function(){return fetch(y+e,s)})).then((function(e){if(!e.ok)throw new Error;return e.json()}))}var E=function(e){return k(e)},P=function(e,t){return k(e,"POST",t)},S=function(e){return k(e,"DELETE")},I=function(e){return E("/posts?userId=".concat(e))},L=function(e){var t,n=e.setError,r=e.setPosts,a=e.setLoading,o=e.setCurrentPost,d=e.setCurrentUserId,j=Object(l.useState)([]),h=Object(i.a)(j,2),x=h[0],f=h[1],v=Object(l.useState)(!1),C=Object(i.a)(v,2),y=C[0],w=C[1],k=Object(l.useContext)(p).currentUserId,P=function(){var e=Object(b.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E("/users");case 3:t=e.sent,f(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n(s.GetUsers);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=Object(b.a)(O.a.mark((function e(t){var i;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(c.Posts),n(s.None),o(null),e.prev=3,e.next=6,I(t);case 6:i=e.sent,r(i),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),n(s.GetPosts);case 13:return e.prev=13,a(c.None),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,10,13,16]])})));return function(t){return e.apply(this,arguments)}}();Object(l.useEffect)((function(){P()}),[]);var L=Object(l.useCallback)((function(e){var t=e.target.closest(".dropdown-trigger"),n=e.target.matches(".dropdown-item");y&&(t||n||w(!1))}),[y]);Object(l.useEffect)((function(){return document.addEventListener("click",L),function(){document.removeEventListener("click",L)}}),[y]);var U=null===(t=x.find((function(e){return e.id===k})))||void 0===t?void 0:t.name;return Object(m.jsxs)("div",{"data-cy":"UserSelector",className:u()("dropdown",{"is-active":y}),children:[Object(m.jsx)(N,{userName:U||"",toggleDropdown:function(){w((function(e){return!e}))}}),Object(m.jsx)(g,{users:x,selectUser:function(e){d(e),S(e),w(!1)}})]})},U=function(e){var t=e.type,n=void 0===t?"warning":t,s=e.text,r=e.dataCy;return Object(m.jsx)("div",{className:"notification is-".concat(n),"data-cy":r,children:s})},F=function(e){var t=e.post,n=e.currentPostId,s=e.getComments;return Object(m.jsxs)("tr",{"data-cy":"Post",children:[Object(m.jsx)("td",{"data-cy":"PostId",children:t.id}),Object(m.jsx)("td",{"data-cy":"PostTitle",children:t.title}),Object(m.jsx)("td",{className:"has-text-right is-vcentered",children:Object(m.jsx)(z,{type:"button",dataCy:"PostButton",className:u()({"is-light":n!==t.id}),onClick:function(){return s(t)},children:n!==t.id?"Open":"Close"})})]})},T=function(e){var t=e.posts,n=e.currentPostId,r=e.setCurrentPost,a=e.setLoading,o=e.setComments,i=e.setError,l=function(){var e=Object(b.a)(O.a.mark((function e(t){var l;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==t.id){e.next=3;break}return r(null),e.abrupt("return");case 3:return a(c.Comments),r(t),e.prev=5,e.next=8,d=t.id,E("/comments?postId=".concat(d));case 8:l=e.sent,o(l),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),i(s.GetComments);case 15:return e.prev=15,a(c.None),e.finish(15);case 18:case"end":return e.stop()}var d}),e,null,[[5,12,15,18]])})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)("div",{"data-cy":"PostsList",children:[Object(m.jsx)("p",{className:"title",children:"Posts:"}),Object(m.jsxs)("table",{className:"table is-fullwidth is-striped is-hoverable is-narrow",children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{className:"has-background-link-light",children:[Object(m.jsx)("th",{children:"#"}),Object(m.jsx)("th",{children:"Title"}),Object(m.jsx)("th",{children:" "})]})}),Object(m.jsx)("tbody",{children:t.map((function(e){return Object(m.jsx)(F,{post:e,currentPostId:n,getComments:l},e.id)}))})]})]})},G=n(6),D=function(e){var t=e.comment,n=e.removeComment;return Object(m.jsxs)("article",{className:"message is-small","data-cy":"Comment",children:[Object(m.jsxs)("div",{className:"message-header",children:[Object(m.jsx)("a",{href:"mailto:".concat(t.email),"data-cy":"CommentAuthor",children:t.name}),Object(m.jsx)("button",{type:"button","data-cy":"CommentDelete","aria-label":"delete",className:"delete is-small",onClick:function(){return n(t.id)}})]}),Object(m.jsx)("div",{className:"message-body","data-cy":"CommentBody",children:t.body})]})},A=function(e){var t=e.isForm,n=e.setIsForm,c=e.removeComment,a=Object(l.useContext)(f),o=a.error,i=a.comments;Object(l.useEffect)((function(){return function(){return n(!1)}}),[]);return Object(m.jsxs)(m.Fragment,{children:[i.length?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("p",{className:"title is-4",children:"Comments:"}),o===s.RemoveComment&&Object(m.jsx)(U,{type:r.Danger,text:"Something went wrong!"}),i.map((function(e){return Object(m.jsx)(D,{comment:Object(G.a)({},e),removeComment:c},e.id)}))]}):Object(m.jsx)("p",{className:"title is-4","data-cy":"NoCommentsMessage",children:"No comments yet"}),!t&&Object(m.jsx)(z,{dataCy:"WriteCommentButton",onClick:function(){return n(!0)},children:"Write a comment"})]})},B=n(9),M=n(11),_=function(e){var t=e.name,n=e.hasIcon;return e.hasError?Object(m.jsxs)(m.Fragment,{children:[n&&Object(m.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(m.jsx)("i",{className:"fas fa-exclamation-triangle"})}),Object(m.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Body"===t?"Enter some text":"".concat(t," is required")})]}):null},J=function(e){var t=e.icon;return Object(m.jsx)("span",{className:"icon is-small is-left",children:Object(m.jsx)("i",{className:"fas fa-".concat(t)})})},R=function(e){var t=e.id,n=e.icon,s=e.name,r=e.value,c=e.hasError,a=e.placeholder,o=e.onChange;return Object(m.jsxs)("div",{className:"field","data-cy":"".concat(s,"Field"),children:[Object(m.jsx)("label",{className:"label",htmlFor:t,children:"Author ".concat(s)}),Object(m.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(m.jsx)("input",{type:"text",name:s.toLowerCase(),id:t,value:r,placeholder:a,className:u()("input",{"is-danger":c}),onChange:function(e){return o(s.toLowerCase(),e.target.value)}}),Object(m.jsx)(J,{icon:n}),Object(m.jsx)(_,{hasIcon:!0,name:s,hasError:c})]})]})},W=function(e){var t=e.id,n=e.name,s=e.value,r=e.hasError,c=e.labelText,a=e.placeholder,o=e.onChange;return Object(m.jsxs)("div",{className:"field","data-cy":"".concat(n,"Field"),children:[Object(m.jsx)("label",{className:"label",htmlFor:t,children:c}),Object(m.jsx)("div",{className:"control",children:Object(m.jsx)("textarea",{id:t,value:s,name:n.toLowerCase(),placeholder:a,className:u()("textarea",{"is-danger":r}),onChange:function(e){return o(n.toLowerCase(),e.target.value)}})}),Object(m.jsx)(_,{name:n,hasError:r})]})},q=function(){var e=Object(l.useState)([]),t=Object(i.a)(e,2),n=t[0],r=t[1],a=Object(l.useState)({name:"",email:"",body:""}),o=Object(i.a)(a,2),d=o[0],u=o[1],j=Object(l.useContext)(f),h=j.post,x=j.loading,v=j.setError,p=j.setLoading,C=j.setComments,g=Object(l.useCallback)((function(e){return Object.entries(e).forEach((function(e){e[1]||r((function(t){return[].concat(Object(M.a)(t),[e[0]])}))})),Object.values(e).some((function(e){return!e.length}))}),[n]),N=Object(l.useCallback)(function(){var e=Object(b.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!g(d)){e.next=4;break}return e.abrupt("return");case 4:return p(c.AddComment),e.prev=5,e.next=8,r=Object(G.a)(Object(G.a)({},d),{},{postId:(null===h||void 0===h?void 0:h.id)||0}),P("/comments",r);case 8:n=e.sent,C((function(e){return[].concat(Object(M.a)(e),[n])})),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),v(s.AddComment);case 15:return e.prev=15,p(c.None),e.finish(15);case 18:u((function(e){return Object(Object(G.a)(Object(G.a)({},e),{},{body:""}))}));case 19:case"end":return e.stop()}var r}),e,null,[[5,12,15,18]])})));return function(t){return e.apply(this,arguments)}}(),[n,d]),y=function(e,t){u((function(n){return Object(Object(G.a)(Object(G.a)({},n),{},Object(B.a)({},e,t)))})),n.includes(e)&&r((function(t){return t.filter((function(t){return t!==e}))}))},w=Object(l.useCallback)((function(){u({name:"",email:"",body:""}),r([])}),[d]);return Object(m.jsxs)("form",{"data-cy":"NewCommentForm",onSubmit:N,children:[Object(m.jsx)(R,{id:"comment-author-name",name:"Name",icon:"user",value:d.name,placeholder:"Name Surname",hasError:n.includes("name"),onChange:y}),Object(m.jsx)(R,{id:"comment-author-email",name:"Email",icon:"envelope",value:d.email,placeholder:"email@test.com",hasError:n.includes("email"),onChange:y}),Object(m.jsx)(W,{id:"comment-body",name:"Body",value:d.body,labelText:"Enter some text",placeholder:"Type comment here",hasError:n.includes("body"),onChange:y}),Object(m.jsxs)("div",{className:"field is-grouped",children:[Object(m.jsx)("div",{className:"control",children:Object(m.jsx)(z,{type:"submit",loading:x===c.AddComment,children:"Add"})}),Object(m.jsx)("div",{className:"control",children:Object(m.jsx)(z,{type:"reset",className:"is-light",onClick:w,children:"Clear"})})]})]})},Y=function(){var e=Object(l.useContext)(f),t=e.post,n=e.error,a=e.loading,o=e.setComments,d=e.setError,u=Object(l.useState)(!1),h=Object(i.a)(u,2),x=h[0],v=h[1],p=function(){var e=Object(b.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o((function(e){return e.filter((function(e){return e.id!==t}))})),e.prev=1,e.next=4,S("/comments/".concat(t));case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),d(s.RemoveComment);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)("div",{className:"content","data-cy":"PostDetails",children:[Object(m.jsxs)("div",{className:"block",children:[Object(m.jsx)("h2",{"data-cy":"PostTitle",children:"#".concat(null===t||void 0===t?void 0:t.id,": ").concat(null===t||void 0===t?void 0:t.title)}),Object(m.jsx)("p",{"data-cy":"PostBody",children:null===t||void 0===t?void 0:t.body})]}),Object(m.jsx)("div",{className:"block",children:a===c.Comments?Object(m.jsx)(j,{}):Object(m.jsx)(m.Fragment,{children:n===s.GetComments?Object(m.jsx)(U,{type:r.Danger,dataCy:"CommentsError",text:"Something went wrong"}):Object(m.jsx)(A,{isForm:x,setIsForm:v,removeComment:p})})}),x&&t&&Object(m.jsx)(q,{})]})},z=function(e){var t=e.type,n=void 0===t?"button":t,s=e.loading,r=e.dataCy,c=e.className,a=e.disabled,o=void 0!==a&&a,i=e.children,l=e.onClick;return Object(m.jsx)("button",{type:n,"data-cy":r,className:u()("button is-link",c,{"is-loading":s}),onClick:l,disabled:o,children:i})},H=function(){var e=Object(l.useState)([]),t=Object(i.a)(e,2),n=t[0],a=t[1],o=Object(l.useState)([]),d=Object(i.a)(o,2),b=d[0],h=d[1],O=Object(l.useState)(0),x=Object(i.a)(O,2),v=x[0],C=x[1],g=Object(l.useState)(null),N=Object(i.a)(g,2),y=N[0],w=N[1],k=Object(l.useState)(s.None),E=Object(i.a)(k,2),P=E[0],S=E[1],I=Object(l.useState)(c.None),F=Object(i.a)(I,2),G=F[0],D=F[1],A=Object(l.useMemo)((function(){return!n.length&&!!v&&!G&&!P}),[n,v,G]),B=Object(l.useMemo)((function(){return Object({error:P,currentUserId:v})}),[P,v]),M=Object(l.useMemo)((function(){return Object({post:y,error:P,loading:G,comments:b,setLoading:D,setComments:h,setError:S})}),[y,P,G,b]);return Object(m.jsx)("main",{className:"section","aria-hidden":"true",children:Object(m.jsx)("div",{className:"container",children:Object(m.jsxs)("div",{className:"tile is-ancestor",children:[Object(m.jsx)("div",{className:"tile is-parent",children:Object(m.jsxs)("div",{className:"tile is-child box is-success",children:[Object(m.jsx)("div",{className:"block",children:Object(m.jsx)(p.Provider,{value:B,children:Object(m.jsx)(L,{setError:S,setLoading:D,setPosts:a,setCurrentPost:w,setCurrentUserId:C})})}),Object(m.jsxs)("div",{className:"block","data-cy":"MainContent",children:[!v&&P!==s.GetUsers&&Object(m.jsx)("p",{"data-cy":"NoSelectedUser",children:"No user selected"}),G===c.Posts&&Object(m.jsx)(j,{}),P===s.GetPosts&&Object(m.jsx)(U,{type:r.Danger,dataCy:"PostsLoadingError",text:"Something went wrong!"}),A&&Object(m.jsx)(U,{dataCy:"NoPostsYet",text:"No posts yet"}),n.length>0&&G!==c.Posts&&Object(m.jsx)(T,{currentPostId:(null===y||void 0===y?void 0:y.id)||0,posts:n,setCurrentPost:w,setLoading:D,setComments:h,setError:S})]})]})}),Object(m.jsx)("div",{"data-cy":"Sidebar",className:u()("tile","is-parent","is-8-desktop","Sidebar",{"Sidebar--open":!!y}),children:Object(m.jsx)("div",{className:"tile is-child box is-success ",children:!!y&&Object(m.jsx)(f.Provider,{value:M,children:Object(m.jsx)(Y,{})})})})]})})})};o.a.render(Object(m.jsx)(H,{}),document.getElementById("root"))}},[[23,1,2]]]);
//# sourceMappingURL=main.2449fa10.chunk.js.map